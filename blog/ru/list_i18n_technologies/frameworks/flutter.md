# Изучаем решения i18n для перевода вашего приложения на Flutter

В все более взаимосвязанном мире предложение вашего приложения на Flutter на нескольких языках может расширить его охват и улучшить удобство использования для тех, кто не говорит по-английски. Реализация международализации (i18n) в Flutter обеспечивает правильное локализованное отображение текста, дат и другой культурно значимой информации. В этой статье мы рассмотрим разные подходы к i18n в Flutter — от официальных фреймворков до библиотек, поддерживаемых сообществом, чтобы вы могли выбрать наилучший вариант для вашего проекта.

---

![i18n illustration](https://github.com/aymericzip/intlayer/blob/main/blog/assets/i18n.webp)

## Что такое международализация (i18n)?

Международализация, общепринято называемая i18n, — это процесс проектирования приложения таким образом, чтобы оно могло легко поддерживать несколько языков и культурных форматов. В Flutter это включает в себя настройку вашего приложения для управления локализованными строками, форматами даты/времени и форматами числа без каких-либо проблем. Подготовив ваше приложение на Flutter для i18n, вы создаете прочную основу для интеграции переводов и обработки региональных различий с минимальными затратами.

Если вы новичок в этой концепции, ознакомьтесь с нашей статьей: [Что такое международализация (i18n)? Определение и Проблемы](https://github.com/aymericzip/intlayer/blob/main/blog/ru/what_is_internationalization.md).

---

## Проблема перевода для приложений на Flutter

Реактивная и основанная на виджетах архитектура Flutter представляет некоторые уникальные проблемы i18n:

- **Виджетный интерфейс**: Строки текста могут быть разбросаны по различным виджетам, что требует системного подхода к централизованному управлению переводами, сохраняя при этом реактивность пользовательского интерфейса.
- **Динамическое содержимое**: Переводы для данных в реальном времени или извлекаемых данных (например, из REST API или Firebase) могут усложнить вашу настройку.
- **Управление состоянием**: Поддержание правильной локали во время навигации по приложению и переходов состояний может потребовать решений, таких как `Provider`, `Riverpod` или `Bloc`.
- **Material против Cupertino**: Flutter предлагает кроссплатформенные виджеты пользовательского интерфейса для Android (Material) и iOS (Cupertino), поэтому обеспечение согласованной i18n в обоих случаях может добавить сложности.
- **Развертывание и обновления**: Управление несколькими языками может означать большие пакеты приложения или загрузку языковых ресурсов по запросу, что требует стратегии, уравновешивающей производительность и пользовательский опыт.

---

## Ведущие решения i18n для Flutter

Flutter предоставляет официальную поддержку локализации, а сообщество разработало дополнительные библиотеки, которые упрощают управление несколькими локалями. Ниже представлены некоторые распространенные подходы.

### 1. Официальный i18n Flutter (intl + ARB файлы)

**Обзор**  
Flutter поставляется с официальной поддержкой локализации через пакет [`intl`](https://pub.dev/packages/intl) и интеграцию с библиотекой `flutter_localizations`. Этот подход обычно использует файлы **ARB (Application Resource Bundle)** для хранения и управления вашими переводами.

**Ключевые особенности**

- **Официальная и интегрированная**: Нет необходимости в сторонних библиотеках — `MaterialApp` и `CupertinoApp` могут напрямую ссылаться на ваши локализации.
- **Пакет intl**: Предлагает форматирование даты/числа, обработку множеств, пол и другие функции на основе ICU.
- **Проверки на этапе компиляции**: Генерация кода из ARB файлов помогает выявить отсутствующие переводы во время компиляции.
- **Сильная поддержка сообщества**: Поддерживается Google, с множеством документации и примеров.

**Соображения**

- **Ручная настройка**: Вам потребуется настроить ARB файлы, настроить `MaterialApp` или `CupertinoApp` с помощью `localizationsDelegates` и управлять несколькими файлами `.arb` для каждого языка.
- **Горячая перезагрузка/перезапуск**: Смена языков в режиме выполнения обычно требует полной перезагрузки приложения для восприятия новой локали.
- **Масштабируемость**: Для крупных приложений количество ARB файлов может увеличиться, что требует дисциплинированной структуры папок.

---

### 2. Easy Localization

Репозиторий: [https://pub.dev/packages/easy_localization](https://pub.dev/packages/easy_localization)

**Обзор**  
**Easy Localization** — это библиотека, поддерживаемая сообществом, предназначенная для упрощения задач локализации в Flutter. Она сосредоточена на более динамическом подходе к загрузке и переключению языков, часто с минимальным шаблоном.

**Ключевые особенности**

- **Упрощенная настройка**: Вы можете обернуть свой корневой виджет в `EasyLocalization` для управления поддерживаемыми локалями и переводами без усилий.
- **Смена языков в режиме выполнения**: Меняйте язык приложения на лету без ручного перезапуска, улучшая пользовательский опыт.
- **JSON/YAML/CSV**: Храните переводы в различных форматах файлов для гибкости.
- **Множественные формы и контекст**: Основные функции для управления множественными формами и контекстными переводами.

**Соображения**

- **Меньший контроль**: Хотя проще, у вас может быть меньше возможностей для тонкой настройки оптимизации времени сборки по сравнению с официальным подходом ARB.
- **Производительность**: Загрузка нескольких крупных файлов перевода в режиме выполнения может повлиять на время загрузки для крупных приложений.
- **Сообщество и обновления**: Сильно опирается на сообщество, что может быть плюсом для поддержки, но также подвержено изменениям со временем.

---

### 3. Flutter_i18n

Репозиторий: [https://pub.dev/packages/flutter_i18n](https://pub.dev/packages/flutter_i18n)

**Обзор**  
**Flutter_i18n** предлагает подход, подобный Easy Localization, с акцентом на сохранение переводов и логики вне вашего основного кода виджетов. Он поддерживает как синхронную, так и асинхронную загрузку файлов локализации.

**Ключевые особенности**

- **Несколько форматов файлов**: Используйте JSON или YAML для хранения переводов.
- **Поддержка горячей перезагрузки**: Вы можете динамически переключать языки и сразу видеть изменения в режиме разработки.
- **i18n Виджеты и хуки**: Предоставляют специализированные виджеты, такие как `I18nText`, для упрощенного использования в UI, а также хуки для решений, основанных на состоянии.
- **Локализация на уровне маршрутов**: Ассоциируйте определенные локали с определенными маршрутами или модулями, что может быть полезно для крупных приложений.

**Соображения**

- **Ручное управление языком**: Вам придется внимательно управлять изменениями локали, чтобы избежать состояний гонки или устаревших данных.
- **Нагрузочные расходы на интеграцию**: Хотя это гибко, настройка расширенных функций (таких как вложенные переводы или резервные локали) может потребовать больше конфигурации.
- **Зрелость сообщества**: Достаточно зрелый с постоянными обновлениями, но менее официальный, чем основное решение Flutter.

---

### 4. Intlayer

Сайт: [https://intlayer.org/](https://intlayer.org/)

**Обзор**  
**Intlayer** — это решение с открытым исходным кодом i18n, направленное на упрощение многоязычной поддержки на нескольких фреймворках, включая **Flutter**. Оно делает упор на декларативный подход, строгую типизацию и поддержку SSR в других экосистемах — хотя SSR не является типичным для стандартного Flutter, вы можете найти синергию, если ваш проект использует Flutter web или расширенные фреймворки.

**Ключевые особенности**

- **Декларативный перевод**: Определяйте словари перевода либо на уровне виджета, либо в централизованном файле для улучшенной архитектуры.
- **TypeScript и автозаполнение (Web)**: Хотя эта функция в основном относится к веб-фреймворкам, подход с типизированными переводами все равно может направлять структурированный код в Flutter.
- **Асинхронная загрузка**: Загружайте переводные ресурсы динамически, что может уменьшить начальный размер пакета для многоязычных приложений.
- **Интеграция с Flutter**: Базовая интеграция может быть настроена для использования подхода Intlayer для структурированных переводов.

**Соображения**

- **Зрелость специфического для Flutter**: Несмотря на рост, сообщество Intlayer для Flutter меньше, поэтому вы можете найти меньше учебников или образцов кода, чем с другими библиотеками.
- **SSR**: Библиотека сильно поддерживает SSR в веб-контекстах, но использование Flutter’s SSR более специализировано (например, Flutter web или настраиваемые серверные подходы).
- **Пользовательская настройка**: Требует первоначальной конфигурации, чтобы вписаться в поток `MaterialApp` или `CupertinoApp` Flutter.

---

### Заключительные мысли

При выборе подхода к i18n для Flutter:

1. **Определите ваш рабочий процесс**: Решите, предпочитаете ли вы **переводы на этапе компиляции** (через ARB + `intl`) для лучшей безопасности типов и производительности или **переводы на этапе выполнения** (через Easy Localization, Flutter_i18n) для большей гибкости.
2. **Смена языка**: Если важна смена языка в реальном времени без перезапуска приложения, рассмотрите библиотеку на базе времени выполнения.
3. **Масштабируемость и организация**: По мере роста вашего приложения на Flutter планируйте, как вы будете организовывать, именовать и версионировать свои файлы переводов. Это особенно актуально при работе с многочисленными локалями.
4. **Производительность против гибкости**: Каждый подход включает компромиссы. Предварительно скомпилированные решения, как правило, обеспечивают меньшие накладные расходы во время выполнения, в то время как переводы "на лету" предлагают более бесперебойный пользовательский опыт.
5. **Сообщество и экосистема**: Официальные решения, такие как ARB + `intl`, обычно обеспечивают долгосрочную стабильность. Библиотеки третних сторон предлагают дополнительные удобства и функции времени выполнения, но могут потребовать дополнительного внимания к обновлениям и поддержке.

Все эти решения могут помочь вам создать многоязычное приложение на Flutter. Окончательный выбор зависит от ваших **требований к производительности**, **рабочему процессу разработчика**, **целям пользовательского опыта** и **долгосрочной поддерживаемости**. Тщательно выбирая стратегию, которая соответствует приоритетам вашего проекта, вы сможете убедиться, что ваше приложение Flutter может радовать пользователей по всему миру.
